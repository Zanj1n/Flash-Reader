<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickRead | Modern Speed Reader</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --bg-color: #ffffff;
            --text-color: #1f2937;
            --card-bg: #f9fafb;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            line-height: 1.5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Full-screen mode styles */
        body.fullscreen-mode {
            padding: 0;
            background-color: #000;
            overflow: hidden;
        }

        body.fullscreen-mode .container {
            max-width: none;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body.fullscreen-mode header,
        body.fullscreen-mode .card:not(.reader-section),
        body.fullscreen-mode .reader-header,
        body.fullscreen-mode .progress-section,
        body.fullscreen-mode .speed-control,
        body.fullscreen-mode .settings-section,
        body.fullscreen-mode .instructions {
            display: none !important;
        }

        body.fullscreen-mode .reader-section {
            display: block !important;
            flex: 1;
            background-color: #000;
            padding: 0;
            box-shadow: none;
            border-radius: 0;
            position: relative;
        }

        body.fullscreen-mode .reader-display {
            height: 100vh;
            margin: 0;
            border-radius: 0;
            background-color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        body.fullscreen-mode .word-display {
            font-size: 6rem;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            margin: 0;
            padding: 0;
            line-height: 1.2;
        }

        body.fullscreen-mode .orp-highlight {
            color: #3b82f6;
            text-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
        }

        /* Full-screen dropdown menu */
        .fullscreen-dropdown {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .dropdown-toggle {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .dropdown-toggle:hover {
            background-color: rgba(59, 130, 246, 0.9);
            transform: scale(1.1);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            min-width: 280px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            display: none;
            margin-top: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-menu.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
        }

        .dropdown-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .dropdown-close:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .dropdown-section {
            margin-bottom: 20px;
        }

        .dropdown-label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .dropdown-value {
            display: inline-block;
            margin-left: 8px;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .dropdown-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            margin-top: 8px;
        }

        .dropdown-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .dropdown-timeline {
            margin-top: 8px;
            position: relative;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
        }

        .dropdown-timeline-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .dropdown-timeline-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            cursor: grab;
        }

        .dropdown-timeline-handle:active {
            cursor: grabbing;
        }

        .dropdown-buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .dropdown-btn {
            flex: 1;
            padding: 10px 16px;
            background-color: rgba(59, 130, 246, 0.2);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .dropdown-btn:hover {
            background-color: rgba(59, 130, 246, 0.4);
        }

        .dropdown-btn.exit {
            background-color: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .dropdown-btn.exit:hover {
            background-color: rgba(239, 68, 68, 0.4);
        }

        /* Full-screen hint */
        .fullscreen-hint {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        body.fullscreen-mode .fullscreen-hint {
            opacity: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .theme-panel {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .theme-tabs {
            display: flex;
            gap: 8px;
        }

        .theme-tab {
            padding: 6px 12px;
            border-radius: 999px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            font-weight: 600;
            font-size: .85rem;
            transition: var(--transition);
        }

        .theme-tab:hover {
            transform: translateY(-2px);
        }

        .theme-tab.active {
            background: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
        }

        .theme-selector {
            display: flex;
            gap: 8px;
        }

        .theme-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-btn.active {
            border-color: var(--primary-color);
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }


        .theme-ocean { background: linear-gradient(135deg, #0ea5e9, #2563eb); }
        .theme-sunset { background: linear-gradient(135deg, #fb7185, #f97316); }
        .theme-forest { background: linear-gradient(135deg, #22c55e, #065f46); }
        .theme-purple { background: linear-gradient(135deg, #a78bfa, #6d28d9); }
        .theme-light { background-color: #ffffff; }
        .theme-dark { background-color: #1f2937; }
        .theme-sepia { background-color: #f5e9d9; }
        .theme-high-contrast { background-color: #000000; }


        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }


        .drop-zone-box {
            border: 3px dashed var(--border-color);
            border-radius: var(--radius);
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-color);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .drop-zone-box:hover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.05);
        }

        .drop-zone-box.drag-over {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
            transform: scale(1.01);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.2);
        }

        .drop-zone-box i {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .drop-zone-box h3 {
            font-size: 1.8rem;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .drop-zone-box p {
            color: #6b7280;
            margin-bottom: 24px;
            font-size: 1.1rem;
            max-width: 600px;
        }

        .file-types {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .file-type-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 20px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .file-type-badge i {
            font-size: 1.2rem;
            margin-bottom: 0;
        }

        .file-input-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.1rem;
        }

        .file-input-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .or-divider {
            margin: 20px 0;
            color: #6b7280;
            font-weight: 500;
            position: relative;
            width: 100%;
            text-align: center;
        }

        .or-divider::before,
        .or-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background-color: var(--border-color);
        }

        .or-divider::before {
            left: 0;
        }

        .or-divider::after {
            right: 0;
        }

        .upload-instructions {
            margin-top: 24px;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary-color);
        }

        .upload-instructions h4 {
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .upload-instructions ul {
            padding-left: 20px;
            color: #6b7280;
        }

        .upload-instructions li {
            margin-bottom: 4px;
            font-size: 0.9rem;
        }


        .file-queue {
            margin-top: 24px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: .9rem;
            background: var(--bg-color);
            transition: var(--transition);
        }

        .file-row:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .file-row span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .progress-mini {
            height: 4px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 6px;
            width: 100%;
        }

        .progress-mini > div {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        
        .recent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .recent-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .recent-clear {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: var(--transition);
        }

        .recent-clear:hover {
            color: #ef4444;
        }

        .recent-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recent-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: var(--radius);
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .recent-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .recent-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--primary-color);
        }

        .recent-info {
            flex: 1;
            min-width: 0;
        }

        .recent-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recent-details {
            font-size: 0.85rem;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
        }

        .recent-remove {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .recent-remove:hover {
            color: #ef4444;
            background-color: rgba(239, 68, 68, 0.1);
        }

        .recent-empty {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .recent-empty i {
            font-size: 2.5rem;
            margin-bottom: 16px;
            color: var(--border-color);
        }


        .reader-section {
            display: none;
            grid-column: 1 / -1;
        }

        .reader-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .reader-title {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .reader-controls {
            display: flex;
            gap: 12px;
        }

        .control-btn {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-color);
        }

        .control-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .reader-display {
            background-color: var(--bg-color);
            border-radius: var(--radius);
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .word-display {
            font-size: 3.5rem;
            font-weight: 700;
            text-align: center;
            padding: 20px;
            transition: opacity 0.1s ease;
        }

        .orp-highlight {
            color: var(--primary-color);
        }

        .progress-section {
            margin-bottom: 24px;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            margin-bottom: 12px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: grab;
        }

        .progress-handle:active {
            cursor: grabbing;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .speed-control {
            margin-bottom: 24px;
        }

        .speed-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .speed-label {
            font-weight: 600;
        }

        .speed-value {
            color: var(--primary-color);
            font-weight: 700;
        }

        .speed-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background-color: var(--border-color);
            border-radius: 4px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .settings-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .setting-group {
            flex: 1;
            min-width: 200px;
        }

        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .setting-select, .setting-input {
            width: 100%;
            padding: 10px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .setting-checkbox {
            margin-right: 8px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .instructions {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            grid-column: 1 / -1;
        }

        .instructions h3 {
            margin-bottom: 12px;
            font-size: 1.2rem;
        }

        .instructions ul {
            padding-left: 20px;
            color: #6b7280;
        }

        .instructions li {
            margin-bottom: 8px;
        }


        .theme-dark-active {
            --bg-color: #0f172a;
            --text-color: #f8fafc;
            --card-bg: #1e293b;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        .theme-sepia-active {
            --bg-color: #f5e9d9;
            --text-color: #5c4b37;
            --card-bg: #e8d9c5;
            --border-color: #d4b999;
        }

        .theme-high-contrast-active {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: #222222;
            --border-color: #444444;
            --primary-color: #ffff00;
        }

        .theme-ocean-active {
            --bg-color: #020617;
            --text-color: #e0f2fe;
            --card-bg: #0c4a6e;
            --border-color: #0369a1;
            --primary-color: #38bdf8;
        }

        .theme-sunset-active {
            --bg-color: #1c0f0a;
            --text-color: #fff7ed;
            --card-bg: #7c2d12;
            --border-color: #ea580c;
            --primary-color: #fb7185;
        }

        .theme-forest-active {
            --bg-color: #052e16;
            --text-color: #ecfdf5;
            --card-bg: #065f46;
            --border-color: #059669;
            --primary-color: #22c55e;
        }

        .theme-purple-active {
            --bg-color: #1e1b4b;
            --text-color: #ede9fe;
            --card-bg: #4c1d95;
            --border-color: #7c3aed;
            --primary-color: #a78bfa;
        }

        
        @media (max-width: 768px) {
            .reader-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .reader-controls {
                align-self: stretch;
                justify-content: space-between;
            }

            .word-display {
                font-size: 2.5rem;
            }

            .drop-zone-box {
                padding: 40px 20px;
            }

            .drop-zone-box h3 {
                font-size: 1.5rem;
            }

            .file-types {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .theme-panel {
                flex-direction: column;
                gap: 12px;
                align-items: flex-end;
            }

            body.fullscreen-mode .word-display {
                font-size: 4rem;
            }
            
            .dropdown-menu {
                min-width: 250px;
                right: -10px;
            }
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.1s ease;
        }


        .upload-status {
            margin-top: 16px;
            padding: 12px;
            border-radius: var(--radius);
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--primary-color);
            display: none;
        }

        .upload-status.success {
            background-color: rgba(34, 197, 94, 0.1);
            border-left-color: #22c55e;
        }

        .upload-status.error {
            background-color: rgba(239, 68, 68, 0.1);
            border-left-color: #ef4444;
        }

        .upload-status.info {
            background-color: rgba(59, 130, 246, 0.1);
            border-left-color: var(--primary-color);
        }

        
        .file-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .badge-txt {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .badge-pdf {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .badge-sample {
            background-color: #dcfce7;
            color: #166534;
        }

        
        .sample-toggle {
            margin-top: 20px;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        
        .qol-features ul {
            padding-left: 20px;
            margin-top: 12px;
        }

        .qol-features li {
            margin-bottom: 8px;
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .feature-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            margin-right: 8px;
            font-size: 0.8rem;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Full-screen dropdown menu -->
        <div class="fullscreen-dropdown" id="fullscreen-dropdown">
            <button class="dropdown-toggle" id="dropdown-toggle" title="Fullscreen controls">
                <i class="fas fa-cog"></i>
            </button>
            <div class="dropdown-menu" id="dropdown-menu">
                <div class="dropdown-header">
                    <div class="dropdown-title">Fullscreen Controls</div>
                    <button class="dropdown-close" id="dropdown-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="dropdown-section">
                    <div class="dropdown-label">
                        Reading Speed: <span class="dropdown-value" id="dropdown-speed-value">300 WPM</span>
                    </div>
                    <input type="range" min="100" max="1000" value="300" class="dropdown-slider" id="dropdown-speed-slider">
                </div>
                <div class="dropdown-section">
                    <div class="dropdown-label">
                        Progress: <span class="dropdown-value" id="dropdown-progress-value">0%</span>
                    </div>
                    <div class="dropdown-timeline" id="dropdown-timeline">
                        <div class="dropdown-timeline-progress" id="dropdown-timeline-progress"></div>
                        <div class="dropdown-timeline-handle" id="dropdown-timeline-handle"></div>
                    </div>
                </div>
                <div class="dropdown-buttons">
                    <button class="dropdown-btn" id="dropdown-play-pause">
                        <i class="fas fa-play"></i> Play
                    </button>
                    <button class="dropdown-btn exit" id="dropdown-exit">
                        <i class="fas fa-times"></i> Exit
                    </button>
                </div>
            </div>
        </div>

        <!-- Full-screen hint -->
        <div class="fullscreen-hint" id="fullscreen-hint">
            Press <kbd>F</kbd> or <kbd>ESC</kbd> to exit fullscreen mode
        </div>

        <header>
            <div class="logo">QuickRead</div>
            <div class="theme-panel">
                <div class="theme-tabs">
                    <button class="theme-tab active" data-tab="solid">Solid</button>
                    <button class="theme-tab" data-tab="gradient">Gradient</button>
                </div>
                <div class="theme-selector" id="theme-solid">
                    <div class="theme-btn theme-light active" data-theme="light"></div>
                    <div class="theme-btn theme-dark" data-theme="dark"></div>
                    <div class="theme-btn theme-sepia" data-theme="sepia"></div>
                    <div class="theme-btn theme-high-contrast" data-theme="high-contrast"></div>
                </div>
                <div class="theme-selector" id="theme-gradient" style="display:none">
                    <div class="theme-btn theme-ocean" data-theme="ocean"></div>
                    <div class="theme-btn theme-sunset" data-theme="sunset"></div>
                    <div class="theme-btn theme-forest" data-theme="forest"></div>
                    <div class="theme-btn theme-purple" data-theme="purple"></div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div>
                <section class="card">
                    <h2 style="margin-bottom: 20px; font-size: 1.5rem;">Upload Document</h2>
                    
                    <div class="drop-zone-box" id="drop-zone-box">
                        <i class="fas fa-file-upload"></i>
                        <h3>Drop PDF or TXT Files Here</h3>
                        <p>Drag and drop your documents directly into this box, or click the button below to browse your files</p>
                        
                        <div class="file-types">
                            <div class="file-type-badge">
                                <i class="fas fa-file-pdf"></i>
                                <span>PDF Files</span>
                            </div>
                            <div class="file-type-badge">
                                <i class="fas fa-file-alt"></i>
                                <span>TXT Files</span>
                            </div>
                        </div>
                        
                        <div class="or-divider">OR</div>
                        
                        <button class="file-input-btn" id="upload-btn">
                            <i class="fas fa-folder-open"></i> Browse Files
                        </button>
                        <input type="file" id="file-input" multiple accept=".txt,.pdf" hidden>
                        
                        <div class="upload-status" id="upload-status"></div>
                    </div>
                    
                    <div class="file-queue" id="file-queue"></div>
                    
                    <div class="upload-instructions">
                        <h4>How to upload:</h4>
                        <ul>
                            <li>Drag and drop PDF or TXT files directly into the box above</li>
                            <li>Or click "Browse Files" to select files from your computer</li>
                            <li>Multiple files can be selected or dropped at once</li>
                            <li>Files are processed locally - your data never leaves your browser</li>
                        </ul>
                    </div>
                    
                    <div class="sample-toggle">
                        <div class="checkbox-group">
                            <input type="checkbox" class="setting-checkbox" id="use-sample" checked>
                            <label for="use-sample"><strong>Load sample text for demonstration</strong> - Try the app immediately with example content</label>
                        </div>
                    </div>
                </section>

                <section class="card reader-section" id="reader-section">
                    <div class="reader-header">
                        <div class="reader-title" id="document-title">Reading: Document</div>
                        <div class="reader-controls">
                            <button class="control-btn" id="restart-btn" title="Restart">
                                <i class="fas fa-redo"></i>
                            </button>
                            <button class="control-btn" id="prev-sentence-btn" title="Previous sentence">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="control-btn" id="prev-word-btn" title="Previous word">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="control-btn" id="play-pause-btn" title="Play/Pause">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" id="next-word-btn" title="Next word">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="control-btn" id="next-sentence-btn" title="Next sentence">
                                <i class="fas fa-step-forward"></i>
                            </button>
                        </div>
                    </div>

                    <div class="reader-display">
                        <div class="word-display" id="word-display">Ready to read</div>
                    </div>

                    <div class="progress-section">
                        <div class="progress-bar-container" id="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"></div>
                            <div class="progress-handle" id="progress-handle"></div>
                        </div>
                        <div class="progress-info">
                            <span id="current-position">Word 0 of 0</span>
                            <span id="time-remaining">Time remaining: --:--</span>
                            <span id="percentage-read">0%</span>
                        </div>
                    </div>

                    <div class="speed-control">
                        <div class="speed-header">
                            <span class="speed-label">Reading Speed</span>
                            <span class="speed-value" id="speed-value">300 WPM</span>
                        </div>
                        <input type="range" min="100" max="1000" value="300" class="speed-slider" id="speed-slider">
                    </div>

                    <div class="settings-section">
                        <div class="setting-group">
                            <label class="setting-label" for="font-size">Font Size</label>
                            <select class="setting-select" id="font-size">
                                <option value="2.5">Small</option>
                                <option value="3.5" selected>Medium</option>
                                <option value="4.5">Large</option>
                                <option value="5.5">X-Large</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label" for="font-family">Font Family</label>
                            <select class="setting-select" id="font-family">
                                <option value="Inter, sans-serif" selected>Inter</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Arial, sans-serif">Arial</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <div class="setting-label">Reading Options</div>
                            <div class="checkbox-group">
                                <input type="checkbox" class="setting-checkbox" id="auto-pause" checked>
                                <label for="auto-pause">Auto-pause on focus loss</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" class="setting-checkbox" id="punctuation-pause" checked>
                                <label for="punctuation-pause">Pause on punctuation</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" class="setting-checkbox" id="group-words">
                                <label for="group-words">Group short words</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" class="setting-checkbox" id="highlight-orp" checked>
                                <label for="highlight-orp">Highlight middle letter (ORP)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" class="setting-checkbox" id="fullscreen-shortcut" checked>
                                <label for="fullscreen-shortcut">Enable fullscreen shortcut (F key)</label>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <section class="card">
                <div class="recent-header">
                    <div class="recent-title">Recent Files</div>
                    <button class="recent-clear" id="clear-recent" title="Clear all recent files">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
                <div class="recent-list" id="recent-list">
                    <div class="recent-empty" id="recent-empty">
                        <i class="fas fa-history"></i>
                        <p>No recent files</p>
                        <p style="font-size: 0.9rem; margin-top: 8px;">Dropped files will appear here</p>
                    </div>
                </div>
                
                <div class="qol-features" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 12px;">Quality of Life Features</h4>
                    <ul>
                        <li><span class="feature-icon">✓</span> Multi-file upload queue</li>
                        <li><span class="feature-icon">✓</span> Persistent theme & speed settings</li>
                        <li><span class="feature-icon">✓</span> Auto-resume per file</li>
                        <li><span class="feature-icon">✓</span> Instant drag highlight feedback</li>
                        <li><span class="feature-icon">✓</span> Save last 3 recent files</li>
                        <li><span class="feature-icon">✓</span> Keyboard shortcuts</li>
                        <li><span class="feature-icon">✓</span> 8 beautiful themes</li>
                        <li><span class="feature-icon">✓</span> Fullscreen mode with controls (Press F)</li>
                        <li><span class="feature-icon">✓</span> Customizable reading options</li>
                    </ul>
                </div>
            </section>
        </main>

        <section class="card instructions">
            <h3>How to use QuickRead</h3>
            <ul>
                <li><strong>Drag and drop</strong> PDF or TXT files directly into the large box above</li>
                <li>Recent files are automatically saved (up to 3 most recent files)</li>
                <li>Click on any recent file to reload it instantly</li>
                <li>Use the play/pause button or press <kbd>Space</kbd> to start/stop reading</li>
                <li>Adjust reading speed with the slider (100-1000 words per minute)</li>
                <li>Click or drag on the progress bar to navigate through the text</li>
                <li>Toggle the middle letter highlighting for Optimal Recognition Point</li>
                <li>Use keyboard shortcuts: <kbd>Space</kbd> (play/pause), <kbd>←</kbd>/<kbd>→</kdb> arrows (navigation), <kbd>F</kbd> (fullscreen)</li>
                <li><strong>Press <kbd>F</kbd> to enter fullscreen mode</strong> for distraction-free reading</li>
                <li>In fullscreen mode, click the gear icon for speed and progress controls</li>
                <li>Switch between 8 beautiful themes using the theme selector</li>
                <li>Your reading position is automatically saved for each file</li>
            </ul>
        </section>
    </div>

    <script>
        
        const state = {
            words: [],
            sentences: [],
            currentWordIndex: 0,
            isPlaying: false,
            wpm: parseInt(localStorage.getItem('flowread_wpm')) || 300,
            intervalId: null,
            fontSize: 3.5,
            fontFamily: 'Inter, sans-serif',
            autoPause: true,
            punctuationPause: true,
            groupWords: false,
            highlightORP: localStorage.getItem('flowread_highlight_orp') !== 'false',
            currentDocument: null,
            rawText: '',
            recentFiles: [],
            fileQueue: [],
            isFullscreen: false,
            fullscreenShortcut: localStorage.getItem('flowread_fullscreen_shortcut') !== 'false',
            wasPlayingBeforeFullscreen: false
        };

       
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('upload-btn');
        const dropZoneBox = document.getElementById('drop-zone-box');
        const uploadSection = document.querySelector('.card:first-child');
        const readerSection = document.getElementById('reader-section');
        const wordDisplay = document.getElementById('word-display');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevWordBtn = document.getElementById('prev-word-btn');
        const nextWordBtn = document.getElementById('next-word-btn');
        const prevSentenceBtn = document.getElementById('prev-sentence-btn');
        const nextSentenceBtn = document.getElementById('next-sentence-btn');
        const restartBtn = document.getElementById('restart-btn');
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        const progressBar = document.getElementById('progress-bar');
        const progressHandle = document.getElementById('progress-handle');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const currentPosition = document.getElementById('current-position');
        const timeRemaining = document.getElementById('time-remaining');
        const percentageRead = document.getElementById('percentage-read');
        const fontSizeSelect = document.getElementById('font-size');
        const fontFamilySelect = document.getElementById('font-family');
        const autoPauseCheckbox = document.getElementById('auto-pause');
        const punctuationPauseCheckbox = document.getElementById('punctuation-pause');
        const groupWordsCheckbox = document.getElementById('group-words');
        const highlightORPCheckbox = document.getElementById('highlight-orp');
        const fullscreenShortcutCheckbox = document.getElementById('fullscreen-shortcut');
        const themeButtons = document.querySelectorAll('.theme-btn');
        const themeTabs = document.querySelectorAll('.theme-tab');
        const documentTitle = document.getElementById('document-title');
        const uploadStatus = document.getElementById('upload-status');
        const useSampleCheckbox = document.getElementById('use-sample');
        const recentList = document.getElementById('recent-list');
        const recentEmpty = document.getElementById('recent-empty');
        const clearRecentBtn = document.getElementById('clear-recent');
        const fileQueueElement = document.getElementById('file-queue');
        const themeSolid = document.getElementById('theme-solid');
        const themeGradient = document.getElementById('theme-gradient');
        const fullscreenHint = document.getElementById('fullscreen-hint');
        const dropdownToggle = document.getElementById('dropdown-toggle');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const dropdownClose = document.getElementById('dropdown-close');
        const dropdownSpeedSlider = document.getElementById('dropdown-speed-slider');
        const dropdownSpeedValue = document.getElementById('dropdown-speed-value');
        const dropdownTimeline = document.getElementById('dropdown-timeline');
        const dropdownTimelineProgress = document.getElementById('dropdown-timeline-progress');
        const dropdownTimelineHandle = document.getElementById('dropdown-timeline-handle');
        const dropdownPlayPauseBtn = document.getElementById('dropdown-play-pause');
        const dropdownExitBtn = document.getElementById('dropdown-exit');
        const dropdownProgressValue = document.getElementById('dropdown-progress-value');

        
        const sampleText = `QuickRead is a modern speed reading application designed to help you read faster and with better comprehension. Using Rapid Serial Visual Presentation (RSVP), it displays one word at a time at your chosen speed, eliminating the need for eye movements across the page.

        This method allows you to focus on the content without distractions. The application highlights the Optimal Recognition Point (ORP) in each word, typically around the middle of the word, to help your brain process it more quickly.

        You can adjust the reading speed from 100 to 1000 words per minute, navigate through the text using the timeline, and customize the appearance with different themes and font settings. The application automatically saves your progress, so you can return to where you left off.

        For best results, start at a comfortable speed (around 300 WPM) and gradually increase as you become more accustomed to the RSVP method. Remember to take breaks to avoid eye strain and maintain focus.

        Speed reading techniques like RSVP can significantly increase your reading speed while maintaining or even improving comprehension. With practice, many users can double or triple their reading speed. Made by Ossian`;

       
        themeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                themeTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const isGradient = tab.dataset.tab === 'gradient';
                themeSolid.style.display = isGradient ? 'none' : 'flex';
                themeGradient.style.display = isGradient ? 'flex' : 'none';
            });
        });

        
        function loadRecentFiles() {
            const savedRecentFiles = localStorage.getItem('flowread_recent_files');
            if (savedRecentFiles) {
                state.recentFiles = JSON.parse(savedRecentFiles);
                renderRecentFiles();
            }
        }

        
        function saveRecentFiles() {
            localStorage.setItem('flowread_recent_files', JSON.stringify(state.recentFiles));
        }

        
        function addToRecentFiles(fileName, content, fileType, isSample = false) {
            
            state.recentFiles = state.recentFiles.filter(file => file.name !== fileName);
            
            
            state.recentFiles.unshift({
                name: fileName,
                content: content.substring(0, 10000), 
                type: fileType,
                isSample: isSample,
                date: new Date().toISOString(),
                wordCount: tokenizeText(content).length,
                charCount: content.length
            });
            
            
            if (state.recentFiles.length > 3) {
                state.recentFiles = state.recentFiles.slice(0, 3);
            }
            
            saveRecentFiles();
            renderRecentFiles();
        }

        
        function renderRecentFiles() {
            if (state.recentFiles.length === 0) {
                recentEmpty.style.display = 'block';
                recentList.innerHTML = '';
                return;
            }
            
            recentEmpty.style.display = 'none';
            
            let html = '';
            state.recentFiles.forEach((file, index) => {
                const fileDate = new Date(file.date);
                const timeAgo = getTimeAgo(fileDate);
                const fileExtension = file.type === 'sample' ? 'txt' : file.type;
                
                html += `
                    <div class="recent-item" data-index="${index}">
                        <div class="recent-icon">
                            <i class="fas fa-file${file.type === 'pdf' ? '-pdf' : '-alt'}"></i>
                        </div>
                        <div class="recent-info">
                            <div class="recent-name">
                                <span class="file-badge ${file.isSample ? 'badge-sample' : file.type === 'pdf' ? 'badge-pdf' : 'badge-txt'}">
                                    ${fileExtension.toUpperCase()}
                                </span>
                                ${file.name}
                            </div>
                            <div class="recent-details">
                                <span>${file.wordCount} words</span>
                                <span>${timeAgo}</span>
                            </div>
                        </div>
                        <button class="recent-remove" data-index="${index}" title="Remove from recent files">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            });
            
            recentList.innerHTML = html;
            
            
            document.querySelectorAll('.recent-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('recent-remove') && !e.target.closest('.recent-remove')) {
                        const index = parseInt(item.getAttribute('data-index'));
                        loadRecentFile(index);
                    }
                });
            });
            
            
            document.querySelectorAll('.recent-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.getAttribute('data-index'));
                    removeRecentFile(index);
                });
            });
        }

        
        function loadRecentFile(index) {
            if (index >= 0 && index < state.recentFiles.length) {
                const file = state.recentFiles[index];
                initializeText(file.content, file.name);
                showUploadStatus(`"${file.name}" loaded from recent files`, "success");
                
                
                const [movedFile] = state.recentFiles.splice(index, 1);
                state.recentFiles.unshift(movedFile);
                saveRecentFiles();
                renderRecentFiles();
            }
        }

        
        function removeRecentFile(index) {
            if (index >= 0 && index < state.recentFiles.length) {
                state.recentFiles.splice(index, 1);
                saveRecentFiles();
                renderRecentFiles();
                showUploadStatus("File removed from recent files", "info");
            }
        }

        
        function clearAllRecentFiles() {
            state.recentFiles = [];
            saveRecentFiles();
            renderRecentFiles();
            showUploadStatus("All recent files cleared", "info");
        }

        
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        
        function addToFileQueue(file) {
            const row = document.createElement('div');
            row.className = 'file-row';
            row.innerHTML = `
                <span>${file.name}</span>
                <span>${(file.size / 1024).toFixed(1)} KB</span>
            `;
            const prog = document.createElement('div');
            prog.className = 'progress-mini';
            const bar = document.createElement('div');
            prog.appendChild(bar);
            row.appendChild(prog);
            fileQueueElement.appendChild(row);
            
            
            setTimeout(() => {
                bar.style.width = '100%';
            }, 10);
            
            
            setTimeout(() => {
                row.style.opacity = '0';
                row.style.transform = 'translateX(-20px)';
                setTimeout(() => {
                    row.remove();
                }, 300);
            }, 3000);
            
            state.fileQueue.push(file);
        }

        
        loadRecentFiles();
        if (useSampleCheckbox.checked) {
            initializeText(sampleText, "Sample Text");
            addToRecentFiles("Sample Text", sampleText, "txt", true);
        }

        
        uploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        useSampleCheckbox.addEventListener('change', handleSampleToggle);
        clearRecentBtn.addEventListener('click', clearAllRecentFiles);
        dropdownToggle.addEventListener('click', toggleDropdown);
        dropdownClose.addEventListener('click', closeDropdown);
        dropdownSpeedSlider.addEventListener('input', handleDropdownSpeedChange);
        dropdownPlayPauseBtn.addEventListener('click', togglePlayPause);
        dropdownExitBtn.addEventListener('click', toggleFullscreen);
        
        dropdownTimeline.addEventListener('click', handleDropdownTimelineClick);
        
        let isDropdownDragging = false;
        dropdownTimelineHandle.addEventListener('mousedown', () => {
            isDropdownDragging = true;
            document.addEventListener('mousemove', handleDropdownDrag);
            document.addEventListener('mouseup', () => {
                isDropdownDragging = false;
                document.removeEventListener('mousemove', handleDropdownDrag);
            });
        });
        
        
        document.addEventListener('click', (e) => {
            if (!dropdownMenu.contains(e.target) && !dropdownToggle.contains(e.target)) {
                closeDropdown();
            }
        });
        
        
        dropZoneBox.addEventListener('click', (e) => {
            
            if (e.target === dropZoneBox || e.target.classList.contains('fa-file-upload')) {
                fileInput.click();
            }
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZoneBox.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZoneBox.classList.add('drag-over');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropZoneBox.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZoneBox.classList.remove('drag-over');
            });
        });
        
        dropZoneBox.addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.dataTransfer.files.length) {
                handleFileUpload({ target: { files: e.dataTransfer.files } });
            }
        });

        playPauseBtn.addEventListener('click', togglePlayPause);
        prevWordBtn.addEventListener('click', () => moveWord(-1));
        nextWordBtn.addEventListener('click', () => moveWord(1));
        prevSentenceBtn.addEventListener('click', () => moveSentence(-1));
        nextSentenceBtn.addEventListener('click', () => moveSentence(1));
        restartBtn.addEventListener('click', restartReading);

        speedSlider.addEventListener('input', () => {
            state.wpm = parseInt(speedSlider.value);
            speedValue.textContent = `${state.wpm} WPM`;
            dropdownSpeedValue.textContent = `${state.wpm} WPM`;
            dropdownSpeedSlider.value = state.wpm;
            localStorage.setItem('flowread_wpm', state.wpm);
            if (state.isPlaying) {
                clearInterval(state.intervalId);
                startReading();
            }
        });

        progressBarContainer.addEventListener('click', (e) => {
            const rect = progressBarContainer.getBoundingClientRect();
            const clickPosition = (e.clientX - rect.left) / rect.width;
            const newIndex = Math.floor(clickPosition * state.words.length);
            jumpToWord(newIndex);
        });

        let isDragging = false;
        progressHandle.addEventListener('mousedown', () => {
            isDragging = true;
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.removeEventListener('mousemove', handleDrag);
            });
        });

        progressHandle.addEventListener('touchstart', () => {
            isDragging = true;
            document.addEventListener('touchmove', handleDrag);
            document.addEventListener('touchend', () => {
                isDragging = false;
                document.removeEventListener('touchmove', handleDrag);
            });
        });

        fontSizeSelect.addEventListener('change', () => {
            state.fontSize = parseFloat(fontSizeSelect.value);
            wordDisplay.style.fontSize = `${state.fontSize}rem`;
        });

        fontFamilySelect.addEventListener('change', () => {
            state.fontFamily = fontFamilySelect.value;
            wordDisplay.style.fontFamily = state.fontFamily;
        });

        autoPauseCheckbox.addEventListener('change', () => {
            state.autoPause = autoPauseCheckbox.checked;
        });

        punctuationPauseCheckbox.addEventListener('change', () => {
            state.punctuationPause = punctuationPauseCheckbox.checked;
        });

        groupWordsCheckbox.addEventListener('change', () => {
            state.groupWords = groupWordsCheckbox.checked;
        });

        highlightORPCheckbox.addEventListener('change', () => {
            state.highlightORP = highlightORPCheckbox.checked;
            localStorage.setItem('flowread_highlight_orp', state.highlightORP);
            updateWordDisplay();
        });

        fullscreenShortcutCheckbox.addEventListener('change', () => {
            state.fullscreenShortcut = fullscreenShortcutCheckbox.checked;
            localStorage.setItem('flowread_fullscreen_shortcut', state.fullscreenShortcut);
        });

        themeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const theme = button.getAttribute('data-theme');
                setTheme(theme);
            });
        });

        
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA') return;
            
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    moveWord(-1);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    moveWord(1);
                    break;
                case 'Home':
                    e.preventDefault();
                    jumpToWord(0);
                    break;
                case 'End':
                    e.preventDefault();
                    jumpToWord(state.words.length - 1);
                    break;
                case 'f':
                case 'F':
                    if (state.fullscreenShortcut && readerSection.style.display === 'block') {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    break;
                case 'Escape':
                    if (state.isFullscreen) {
                        e.preventDefault();
                        toggleFullscreen();
                        closeDropdown();
                    }
                    break;
            }
        });

        
        window.addEventListener('blur', () => {
            if (state.autoPause && state.isPlaying) {
                togglePlayPause();
            }
        });

        
        function toggleDropdown() {
            dropdownMenu.classList.toggle('show');
        }

        function closeDropdown() {
            dropdownMenu.classList.remove('show');
        }

        function handleDropdownSpeedChange() {
            state.wpm = parseInt(dropdownSpeedSlider.value);
            speedValue.textContent = `${state.wpm} WPM`;
            dropdownSpeedValue.textContent = `${state.wpm} WPM`;
            speedSlider.value = state.wpm;
            localStorage.setItem('flowread_wpm', state.wpm);
            if (state.isPlaying) {
                clearInterval(state.intervalId);
                startReading();
            }
        }

        function handleDropdownTimelineClick(e) {
            const rect = dropdownTimeline.getBoundingClientRect();
            const clickPosition = (e.clientX - rect.left) / rect.width;
            const newIndex = Math.floor(clickPosition * state.words.length);
            jumpToWord(newIndex);
        }

        function handleDropdownDrag(e) {
            if (!isDropdownDragging) return;
            
            const rect = dropdownTimeline.getBoundingClientRect();
            let clientX = e.clientX;
            let relativeX = clientX - rect.left;
            relativeX = Math.max(0, Math.min(relativeX, rect.width));
            
            const progress = relativeX / rect.width;
            const newIndex = Math.floor(progress * state.words.length);
            
            jumpToWord(newIndex);
        }

        
        function toggleFullscreen() {
            if (!state.isFullscreen) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            if (state.words.length === 0) {
                showUploadStatus("Please load text first before entering fullscreen mode", "error");
                return;
            }
            
            
            state.wasPlayingBeforeFullscreen = state.isPlaying;
            
            state.isFullscreen = true;
            document.body.classList.add('fullscreen-mode');
            
            
            updateWordDisplayForFullscreen();
            updateDropdownControls();
            
            showUploadStatus("Entered fullscreen mode. Click the gear icon for controls.", "info");
        }

        function exitFullscreen() {
            state.isFullscreen = false;
            document.body.classList.remove('fullscreen-mode');
            
            
            if (state.wasPlayingBeforeFullscreen && !state.isPlaying) {
                startReading();
            }
            
            
            updateWordDisplay();
            closeDropdown();
            
            showUploadStatus("Exited fullscreen mode", "info");
        }

        function updateWordDisplayForFullscreen() {
            if (state.words.length === 0) {
                wordDisplay.textContent = "No text loaded";
                return;
            }
            
            const word = state.words[state.currentWordIndex];
            wordDisplay.classList.remove('fade-in');
            
            
            wordDisplay.style.fontSize = '6rem';
            wordDisplay.style.color = '#fff';
            wordDisplay.style.textAlign = 'center';
            wordDisplay.style.padding = '0';
            wordDisplay.style.margin = '0';
            wordDisplay.style.lineHeight = '1.2';
            wordDisplay.style.width = '100%';
            wordDisplay.style.display = 'flex';
            wordDisplay.style.alignItems = 'center';
            wordDisplay.style.justifyContent = 'center';
            wordDisplay.style.height = '100%';
            
            if (state.highlightORP) {
                
                let orpIndex = Math.floor(word.length / 2);
                if (word.length <= 3) orpIndex = 1;
                
                
                let displayWord = '';
                if (word === '\n') {
                    displayWord = '<br><span class="orp-highlight">¶</span>';
                } else {
                    for (let i = 0; i < word.length; i++) {
                        if (i === orpIndex) {
                            displayWord += `<span class="orp-highlight">${word[i]}</span>`;
                        } else {
                            displayWord += word[i];
                        }
                    }
                }
                
                wordDisplay.innerHTML = displayWord;
            } else {
                
                if (word === '\n') {
                    wordDisplay.innerHTML = '<br>¶';
                } else {
                    wordDisplay.textContent = word;
                }
            }
            
            
            setTimeout(() => {
                wordDisplay.classList.add('fade-in');
            }, 10);
        }

        function updateDropdownControls() {
            
            dropdownSpeedSlider.value = state.wpm;
            dropdownSpeedValue.textContent = `${state.wpm} WPM`;
            
            
            const progress = (state.currentWordIndex + 1) / state.words.length * 100;
            dropdownTimelineProgress.style.width = `${progress}%`;
            dropdownTimelineHandle.style.left = `${progress}%`;
            dropdownProgressValue.textContent = `${Math.round(progress)}%`;
            
            
            if (state.isPlaying) {
                dropdownPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            } else {
                dropdownPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
            }
        }

        
        function handleSampleToggle() {
            if (useSampleCheckbox.checked) {
                initializeText(sampleText, "Sample Text");
                addToRecentFiles("Sample Text", sampleText, "txt", true);
                showUploadStatus("Sample text loaded successfully", "success");
            } else {
                
                if (state.currentDocument === "Sample Text") {
                    state.words = [];
                    state.sentences = [];
                    state.currentWordIndex = 0;
                    updateWordDisplay();
                    updateProgress();
                    
                    
                    readerSection.style.display = 'none';
                    uploadSection.style.display = 'block';
                }
            }
        }

        function handleFileUpload(event) {
            const files = event.target.files;
            if (!files.length) return;
            
            
            Array.from(files).forEach(file => {
                addToFileQueue(file);
            });
            
            
            const file = files[0];
            const fileName = file.name;
            const fileExtension = fileName.split('.').pop().toLowerCase();
            
            if (fileExtension === 'txt') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    initializeText(text, fileName);
                    addToRecentFiles(fileName, text, "txt");
                    showUploadStatus(`"${fileName}" loaded successfully`, "success");
                };
                reader.readAsText(file);
            } else if (fileExtension === 'pdf') {
                
                showUploadStatus("PDF parsing is simulated in this demo. Loading sample text instead.", "info");
                initializeText(sampleText, fileName);
                addToRecentFiles(fileName, sampleText, "pdf");
            } else {
                showUploadStatus("Please upload a .txt or .pdf file.", "error");
            }
            
            
            fileInput.value = '';
        }

        function showUploadStatus(message, type = "info") {
            uploadStatus.textContent = message;
            uploadStatus.className = "upload-status";
            uploadStatus.classList.add(type);
            uploadStatus.style.display = "block";
            
            
            setTimeout(() => {
                uploadStatus.style.display = "none";
            }, 5000);
        }

        function initializeText(text, title) {
            
            const cleanedText = cleanText(text);
            state.rawText = cleanedText;
            
           
            state.sentences = cleanedText.split(/(?<=[.!?])\s+/).filter(s => s.trim().length > 0);
            
            
            state.words = tokenizeText(cleanedText);
            
            
            const savedPosition = localStorage.getItem('flowread_last_position_' + title);
            if (savedPosition) {
                state.currentWordIndex = parseInt(savedPosition);
            } else {
                state.currentWordIndex = 0;
            }
            
            
            updateWordDisplay();
            updateProgress();
            updateDropdownControls();
            
            
            readerSection.style.display = 'block';
            
            
            documentTitle.textContent = `Reading: ${title}`;
            
            
            state.currentDocument = title;
        }

        function cleanText(text) {
            
            return text
                .replace(/\n{3,}/g, '\n\n') 
                .replace(/\t/g, ' ') 
                .replace(/\s{2,}/g, ' ') 
                .trim();
        }

        function tokenizeText(text) {
            
            const tokens = text.match(/\S+|\n/g) || [];
            return tokens;
        }

        function togglePlayPause() {
            if (state.isPlaying) {
                pauseReading();
            } else {
                startReading();
            }
        }

        function startReading() {
            if (state.currentWordIndex >= state.words.length) {
                state.currentWordIndex = 0;
            }
            
            state.isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            dropdownPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            
            const intervalMs = 60000 / state.wpm;
            state.intervalId = setInterval(() => {
                if (state.currentWordIndex < state.words.length - 1) {
                    moveWord(1);
                } else {
                    pauseReading();
                }
            }, intervalMs);
        }

        function pauseReading() {
            state.isPlaying = false;
            clearInterval(state.intervalId);
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            dropdownPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i> Play';
            
           
            if (state.currentDocument) {
                localStorage.setItem('flowread_last_position_' + state.currentDocument, state.currentWordIndex);
            }
        }

        function moveWord(direction) {
            const newIndex = state.currentWordIndex + direction;
            if (newIndex >= 0 && newIndex < state.words.length) {
                state.currentWordIndex = newIndex;
                
                if (state.isFullscreen) {
                    updateWordDisplayForFullscreen();
                } else {
                    updateWordDisplay();
                }
                
                updateProgress();
                updateDropdownControls();
                
                
                if (state.isPlaying && state.punctuationPause) {
                    const currentWord = state.words[state.currentWordIndex];
                    if (/[.!?;:]$/.test(currentWord)) {
                        
                        clearInterval(state.intervalId);
                        setTimeout(() => {
                            if (state.isPlaying) {
                                startReading();
                            }
                        }, 200);
                    }
                }
            }
        }

        function moveSentence(direction) {
            
            let currentSentenceEnd = 0;
            let sentenceIndex = 0;
            
            for (let i = 0; i < state.sentences.length; i++) {
                const sentenceWords = tokenizeText(state.sentences[i]);
                currentSentenceEnd += sentenceWords.length;
                
                if (state.currentWordIndex < currentSentenceEnd) {
                    sentenceIndex = i;
                    break;
                }
            }
            
            
            const newSentenceIndex = sentenceIndex + direction;
            if (newSentenceIndex >= 0 && newSentenceIndex < state.sentences.length) {
                
                let wordIndex = 0;
                for (let i = 0; i < newSentenceIndex; i++) {
                    const sentenceWords = tokenizeText(state.sentences[i]);
                    wordIndex += sentenceWords.length;
                }
                
                jumpToWord(wordIndex);
            }
        }

        function jumpToWord(index) {
            index = Math.max(0, Math.min(index, state.words.length - 1));
            state.currentWordIndex = index;
            
            if (state.isFullscreen) {
                updateWordDisplayForFullscreen();
            } else {
                updateWordDisplay();
            }
            
            updateProgress();
            updateDropdownControls();
            
            if (state.isPlaying) {
                clearInterval(state.intervalId);
                startReading();
            }
        }

        function restartReading() {
            jumpToWord(0);
        }

        function updateWordDisplay() {
            if (state.words.length === 0) {
                wordDisplay.textContent = "No text loaded";
                return;
            }
            
            const word = state.words[state.currentWordIndex];
            wordDisplay.classList.remove('fade-in');
            
            
            wordDisplay.style.fontSize = `${state.fontSize}rem`;
            wordDisplay.style.color = '';
            wordDisplay.style.textAlign = 'center';
            wordDisplay.style.padding = '20px';
            wordDisplay.style.margin = '';
            wordDisplay.style.lineHeight = '';
            wordDisplay.style.width = '';
            wordDisplay.style.display = '';
            wordDisplay.style.alignItems = '';
            wordDisplay.style.justifyContent = '';
            wordDisplay.style.height = '';
            
            if (state.highlightORP) {
                
                let orpIndex = Math.floor(word.length / 2);
                if (word.length <= 3) orpIndex = 1;
                
                
                let displayWord = '';
                if (word === '\n') {
                    displayWord = '<br><span class="orp-highlight">¶</span>';
                } else {
                    for (let i = 0; i < word.length; i++) {
                        if (i === orpIndex) {
                            displayWord += `<span class="orp-highlight">${word[i]}</span>`;
                        } else {
                            displayWord += word[i];
                        }
                    }
                }
                
                wordDisplay.innerHTML = displayWord;
            } else {
                
                if (word === '\n') {
                    wordDisplay.innerHTML = '<br>¶';
                } else {
                    wordDisplay.textContent = word;
                }
            }
            
            
            setTimeout(() => {
                wordDisplay.classList.add('fade-in');
            }, 10);
        }

        function updateProgress() {
            if (state.words.length === 0) return;
            
            const progress = (state.currentWordIndex + 1) / state.words.length * 100;
            progressBar.style.width = `${progress}%`;
            
            const handlePosition = progressBarContainer.offsetWidth * (progress / 100);
            progressHandle.style.left = `${handlePosition}px`;
            
            currentPosition.textContent = `Word ${state.currentWordIndex + 1} of ${state.words.length}`;
            percentageRead.textContent = `${Math.round(progress)}%`;
            
            
            const wordsRemaining = state.words.length - state.currentWordIndex;
            const minutesRemaining = wordsRemaining / state.wpm;
            const minutes = Math.floor(minutesRemaining);
            const seconds = Math.floor((minutesRemaining - minutes) * 60);
            timeRemaining.textContent = `Time remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function handleDrag(e) {
            if (!isDragging) return;
            
            let clientX;
            if (e.type.includes('touch')) {
                clientX = e.touches[0].clientX;
            } else {
                clientX = e.clientX;
                e.preventDefault();
            }
            
            const rect = progressBarContainer.getBoundingClientRect();
            let relativeX = clientX - rect.left;
            relativeX = Math.max(0, Math.min(relativeX, rect.width));
            
            const progress = relativeX / rect.width;
            const newIndex = Math.floor(progress * state.words.length);
            
            jumpToWord(newIndex);
        }

        function setTheme(theme) {
            
            document.body.className = '';
            
            
            if (theme !== 'light') {
                document.body.classList.add(`theme-${theme}-active`);
            }
            
            
            themeButtons.forEach(button => {
                button.classList.toggle('active', button.dataset.theme === theme);
            });
            
            state.currentTheme = theme;
            localStorage.setItem('flowread_theme', theme);
        }

        
        const savedTheme = localStorage.getItem('flowread_theme') || 'light';
        setTheme(savedTheme);

        
        speedSlider.value = state.wpm;
        speedValue.textContent = `${state.wpm} WPM`;
        dropdownSpeedSlider.value = state.wpm;
        dropdownSpeedValue.textContent = `${state.wpm} WPM`;
        fontSizeSelect.value = state.fontSize;
        fontFamilySelect.value = state.fontFamily;
        autoPauseCheckbox.checked = state.autoPause;
        punctuationPauseCheckbox.checked = state.punctuationPause;
        groupWordsCheckbox.checked = state.groupWords;
        highlightORPCheckbox.checked = state.highlightORP;
        fullscreenShortcutCheckbox.checked = state.fullscreenShortcut;
        wordDisplay.style.fontSize = `${state.fontSize}rem`;
        wordDisplay.style.fontFamily = state.fontFamily;
    </script>
</body>
</html>
